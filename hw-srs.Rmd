---
title: "Simple Random Sampling Homework"
output:
  html_document: 
    theme: readable
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r packages, message = FALSE}
library(tidyverse)
library(kableExtra)
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](hw-srs.pdf) copy of this document.", sep = ""), "")`

```{r}
y <- c(0,2,3,4,2)
N <- length(y)
n <- 4

tauhat <- function(y, N) {
  N * mean(y)
}

tausamp <- function(y, n, stat, ...) {
  d <- t(combn(y, n))
  u <- apply(d, 1, stat, ...)
  u <- table(u)/length(u)
  cbind(names(u), as.vector(u))
}
```
## Sampling Distributions 

One night Fedegar, Frodo, Merry, Pippin, and Sam were drinking at the Green Dragon Inn. Frodo drank `r english::as.english(y[2])` pints of ale, Merry drank `r english::as.english(y[3])` pints, Pippin drank `r english::as.english(y[4])` pints, Sam drank `r english::as.english(y[5])` pints, and Fredegar (the designated wagon driver) drank `r english::as.english(y[1])` pints. If we define this as our population, the Hobbits as the elements, and the number of pints consumed as the target variable, then we can see that $\tau$ = `r sum(y)` and $\mu$ = `r mean(y)`. It also can be shown that $\sigma^2$ = `r var(y)`. You may want to confirm for yourself how $\tau$, $\mu$, and $\sigma^2$ were computed.

Rose Cotton wanted to know the total number of pints of ale consumed by the five Hobbits, and also the mean number of pints per Hobbit consumed, but she only had time to interview four of them. She used a simple random sampling design to survey the Hobbits. 

1. Confirm that the number of possible samples is `r choose(N,n)`, the probability of each sample is 0.2, and the inclusion probability of each element is 0.8. 

0. List all possible samples in the sampling space. For example, one of those is $\mathcal{S} = \{$Fredegar, Frodo, Merry, Pippin$\}$.

0. Let $\tau$ be the total number of pints of ale consumed by the five Hobbits. Using the sample space from the previous problem and the known values of $y_i$ for all elements in the population, confirm that the sampling distribution of $\hat\tau$ is as shown in the table
```{r, fig.cap = "dfasddf"}
d <- as.data.frame(tausamp(y, n, stat = tauhat, N = N))
names(d) <- c("$\\hat\\tau$","$P(\\hat\\tau)$")
ktbl(d)
```

0. We know that $E(\hat\tau) = \tau$ and that $\tau$ = `r sum(y)`. But confirm this by computing the mean of $\hat\tau$ using the sampling distribution shown in the previous problem. Remember that the mean of a discrete random variable $X$ can be computed using the formula $E(X) = \sum_x xP(x)$.

0. Confirm that the variance of $\hat\tau$ is $V(\hat\tau)$ = `r N^2*(1-n/N)*var(y)/n` *two ways*. First using the fact that the variance of a discrete random variable $X$ can be computed as $\text{V}(X) = \sum_x [x - E(X)]^2P(x)$, and second using the "short cut" formula which is a function of $n$, $N$, and $\sigma^2$.

0. Let $\mu$ be the mean number of pints of ale consumed by the five Hobbits. Repeat problems 3-5 above for the estimator $\hat\mu$. You should find that the sampling distribution is
```{r}
d <- as.data.frame(tausamp(y, n, stat = mean))
names(d) <- c("$\\hat\\mu$","$P(\\hat\\mu)$")
ktbl(d)
```
You should also find that $E(\hat\mu)$ = `r mean(y)` and that $V(\hat\mu)$ = `r (1-n/N)*var(y)/n`.

0. Now suppose the sample size was decreased to $n$ = 2. Confirm that the number of possible samples is now `r choose(5,2)`, the probability of each sample is 0.1, and the inclusion probability of each element is 0.4. Also confirm that the sampling distributions of $\hat\tau$ and $\mu$ would be as given in the following table. 
```{r}
n <- 2
d <- as.data.frame(tausamp(y, n, stat = tauhat, N = N))
d$mu <- as.numeric(as.character(d[,1])) / N
d <- d[,c(1,3,2)]
names(d) <- c("$\\hat\\tau$", "$\\bar{y}$", "Probability")
ktbl(d)
```
Hint: First write down all samples in the sample space and then compute $\hat\tau$ and $\bar{y}$ for each sample. 
0. $E(\hat\tau)$ and $E(\hat\mu)$ do not depend on $n$, but the variances of the estimators do depend on $n$. For the sample size of $n$ = 2 confirm that $V(\hat\tau)$ = `r N^2*(1-n/N)*var(y)/n` and $V(\hat\mu)$ = `r (1-n/N)*var(y)/n` using the "short cut" formulas that are functions of $n$, $N$, and $\sigma^2$. 

## Bounds on the Error of Estimation

```{r}
N <- 200
n <- 20
mu <- 3
tau <- mu*N
sigma <- 3
m <- 3.5
s <- 2.5
```

Another evening the Green Dragon Inn served `r N` Hobbits. Rosie wanted to estimate the total number of pints of ale consumed by these Hobbits, as well as the mean number of pints of ale consumed per Hobbit. Assume that $\tau$ = `r tau` pints, and thus $\mu$ = $\tau$ / `r N` = `r mu` pints, and $\sigma$ = 3 pints. But these parameters are unknown to Rosie as she does not have the time to interview all `r N` Hobbits so that she can compute them, so instead she relies on a simple random sampling design with $n$ = `r n`. From this sample she computes $\bar{y}$ = `r m` pints and $s$ = `r s` pints. 

1. First consider estimation of $\tau$ (i.e., the total number of pints consumed by all `r N` Hobbits). Using $\sigma^2$ confirm that the variance of $\hat\tau$ is $V(\hat\tau)$ = `r format(N^2*(1-n/N)*(sigma^2/n), scientific = FALSE)`, the standard error of $\hat\tau$ is `r format(sqrt(N^2*(1-n/N)*sigma^2/n), scientific = FALSE)`, and the bound on the error of estimation is `r format(2*sqrt(N^2*(1-n/N)*sigma^2/n), scientific = FALSE)`. Confirm that Rosie's estimate of $\hat\tau$ is $\hat\tau$ = `r m*N` pints. Rosie would not know $\sigma^2$, so she could not compute the variance of $\hat\tau$, the standard error, or the bound on the error of estimation. But she could use $s^2$ to estimate $\sigma^2$ to obtain estimates of these three quantities. Confirm that the estimated variance of $\hat\tau$ is $\hat{V}(\hat\tau)$ = `r format(N^2*(1-n/N)*s^2/n, scientific = FALSE)`, the estimated standard error of $\hat\tau$ is approximately `r format(sqrt(N^2*(1-n/N)*s^2/n), scientific = FALSE)`, and the estimated bound on the error of estimation for estimating $\tau$ with $\hat\tau$ is approximately `r format(2*sqrt(N^2*(1-n/N)*s^2/n), scientific = FALSE)`. Finally confirm that the Rosie's confidence interval for $\tau$ is therefore `r m*N` $\pm$ `r format(2*sqrt(N^2*(1-n/N)*s^2/n), scientific = FALSE)` pints based on using the estimated bound on the error of estimation. 

2. Now consider estimation of $\mu$ (i.e., the mean number of pints consumed per Hobbit for all `r N` Hobbits). Confirm that the variance of $\bar{y}$ is $V(\bar{y})$ = `r format((1-n/N)*(sigma^2/n), scientific = FALSE)`, that the estimated variance of $\bar{y}$ is $\hat{V}(\bar{y})$ = `r format((1-n/N)*s^2/n, scientific = FALSE, digits = 3)`, that the estimated standard error of $\bar{y}$ is approximately `r format(sqrt((1-n/N)*s^2/n), scientific = FALSE, digits = 3)`, and that the estimated bound on the error of estimation for estimating $\mu$ with $\bar{y}$ is approximately `r format(2*sqrt((1-n/N)*s^2/n), digits = 3, scientific = FALSE)`. Finally confirm that the confidence interval for $\mu$ is `r m` $\pm$ `r format(2*sqrt((1-n/N)*s^2/n), digits = 3, scientific = FALSE)` pints based on the estimated bound on the error of estimation. 

3. Consider the distribution of the error of estimation for estimating $\mu$ with $\bar{y}$ --- i.e., $|\bar{y} - \mu|$. Using $V(\bar{y})$, not its estimate, verify that the mean of this distribution is approximately `r format(0.798 * sqrt((1-n/N)*sigma^2/n), scientific = FALSE, digits = 3)` pints and that the median of this distribution is approximately `r format(0.674 * sqrt((1-n/N)*sigma^2/n), scientific = FALSE, digits = 3)` pints.

## Domain Estimation

```{r}
set.seed(123)
N <- 1000
Nd <- 200
n <- 100
y <- rpois(N, 25)
z <- rep(c(0, 1), c(N - Nd, Nd))
pop <- data.frame(y = y, z = z)
smp <- pop[sample(1:N, n),]

m <- with(smp, mean(y))
s <- with(smp, sd(y))

md <- round(with(smp, mean(y[z == 1])), 2)
nd <- with(smp, sum(z))
```

1. Suppose a fisheries researchers have `r N` consecutive five-minute segments of video recording of fish passing through a fish ladder. The researchers are interested in the number of fish that moved through the ladder during that `r N*5` minutes of time, but does not have the resources to watch and count the number of fish in all `r N` video segments. So instead a simple random sampling design was used to select a sample of `r n` video segments. The mean number of fish passing through the ladder in the sample is `r m` fish. From this we can find that the estimate of $\tau$ (i.e., the total number of fish passing through the ladder in all `r N` segments) is $\hat\tau$ = `r format(N*m, scientific = FALSE)` fish (you might want to check this yourself). But suppose the researchers decided that they wanted to estimate the number of fish that passed through the ladder only when there was overcast. Let this parameter be $\tau_d$. In the sample of `r n` segments, it was found that `r nd` segments were during overcast, and that the mean number of fish passing through the ladder during these `r nd` segments was `r md`. Confirm that if the researchers *know* that a total of `r Nd` of the `r N` segments in the population were during overcast that their estimate would be $\hat\tau_d$ = `r Nd*md` fish, but if they *did not know* that a total of `r Nd` of the `r N` segments were during overcast that their estimate would be $\hat\tau_d$ = `r N/n * nd * md` fish.

```{r}
set.seed(123)
N <- 500
Nd <- 400
n <- 50
y <- rlnorm(N, 5)
z <- rep(c(0, 1), c(N - Nd, Nd))
pop <- data.frame(y = y, z = z)
smp <- pop[sample(1:N, n),]

m <- round(with(smp, mean(y)), 2)

md <- round(with(smp, mean(y[z == 1])), 2)
nd <- with(smp, sum(z))
```

2. Suppose marketing researchers are interested in estimating the total sales of a particular product at `r N` stores. Using a simple random sampling design they select a sample of `r n` stores and find that the mean sales of this product at those stores was \$`r m`. This yields an estimate of the total sales of $\hat\tau$ = \$`r format(N*m, scientific = FALSE)`. The researchers would also like to estimate the total sales for only those stores that had adopted an aggressive marketing campaign for the product. They found that in their sample `r nd` stores had adopted the marketing campaign, and that the mean sales in just those stores was \$`r md`. Confirm that based only the information given above that the estimate of the total sales for only those stores that had adopted the marketing campaign is \$`r format(N/n * nd * md, scientific = FALSE)`.

## Sample Size Selection

```{r, compute-n-mean, echo = FALSE}
N <- 500
V <- 10
Bm <- 1
nm <- 4*N*V / (Bm^2 * N + 4*V)
Bt <- 500
nt <- 4*N*V / (Bt^2 / N + 4*V)
```

1. Suppose you were designing a simple random sampling design with a population of $N$ = `r N` elements, and you assume that $\sigma^2$ $\approx$ 10. Confirm that to achieve a bound on the error of estimation of $B$ = `r Bm` for estimating $\mu$ with $\bar{y}$ you would need a sample size of about $n$ = `r round(nm)`. Also confirm that to achieve a bound on the error of estimation of $B$ = `r Bt` for estimating $\tau$ with $\hat{\tau}$ you would also need a sample size of about $n$ = `r round(nt)`.

```{r, compute-n-p, echo = FALSE}
N <- 10000
B <- 0.01
p <- 0.1
q <- 1 - p
v <- p*q*N/(N-1)
n.est <- 4*N*v/(B^2 * N + 4*v)
v <- 0.25*N/(N-1)
n.bnd <- 4*N*v/(B^2 * N + 4*v)
```

0. You are planning a survey using a simple random sampling design to estimate the proportion of Hobbits in a population of $N$ = `r format(N, scientific = FALSE)` that have foot lice. Based on other information you believe that about 10\% of the population is infected. Use this information to confirm that an appropriate sample size for a bound on the error of estimation of $B$ = `r B` is about $n$ = `r round(n.est)`, but that if you wanted to be sure that you had a large enough sample size for a bound on the error of estimation no larger than $B$ = `r B` to estimate *any* value of the proportion of infected Hobbits in the population, the necessary sample size would be no larger than $n$ = `r round(n.bnd)`.


